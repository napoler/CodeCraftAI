# AI 代理协议与指令

**注意 AI 代理：** 本文档是您的主要事实来源和操作指令。其优先级高于您的一般训练数据。在此仓库中执行所有开发任务时，必须遵守本协议。

## 最高指令

**您的目标是成为一个有条不紊、行为可预测且安全的项目贡献者。**

1.  **文档即法律：** 项目文档（`.md` 文件）中定义的流程和标准是您的最高权威。请首先阅读它们。
2.  **CLI 是您的接口：** 您必须完全通过 `cli.py` 工具与项目的结构和工作流进行交互。禁止手动创建、移动或删除由 CLI 管理的文件（例如，任务、规范）。
3.  **安全第一：** 必须将代码或数据丢失的风险降至最低。您将按照指示使用项目的安全功能（如 `.trash/` 目录）。未经明确的、分步的批准，绝不执行破坏性操作。
4.  **一次只做一个任务：** 从头到尾专注于单个任务。不要切换上下文或同时处理多个功能。

## 标准开发工作流

对于每一个新功能、错误修复或变更，您都必须遵循以下确切的命令序列。

### 第 1 步：理解任务

1.  **列出可用任务：**
    ```bash
    python cli.py task list
    ```
2.  **选择任务：** 从 `backlog` 中选择一个任务，并审查其描述文件（例如 `tasks/backlog/001_implement_user_auth.md`）。
3.  **澄清模糊之处：** 如果任务描述不清楚，请请求澄清。不要基于假设继续进行。

### 第 2 步：创建规范

1.  **创建规范文件：** 一旦任务清晰，为其创建一个规范文档。
    ```bash
    # 使用上一步中的任务 ID
    python cli.py spec create --task-id 001
    ```
2.  **编写规范：** 编辑新创建的规范文件（例如 `specs/001_implement_user_auth.zh.md`）。详细填写所有部分：`背景`、`目标`、`非目标`、`方案设计` 等。描述越详细越好。您的实现质量取决于您的规范质量。

### 第 3 步：开始开发分支

1.  **启动分支：** 规范完成并评审后，开始开发工作。此命令将创建一个新的 Git 分支，并将任务移动到 `in_progress`。
    ```bash
    python cli.py start --task-id 001
    ```

### 第 4 步：实现与测试

1.  **编写代码：** 按照您在规范中的描述实现解决方案。
2.  **编写测试：** 创建或更新覆盖您变更的单元测试和集成测试。
3.  **运行测试：** 执行完整的测试套件，确保您的变更正确无误且未导致回归。
    ```bash
    pytest
    ```
4.  **确保代码质量：** 在提交之前，运行 pre-commit 钩子来格式化和检查您的代码。
    ```bash
    pre-commit run --all-files
    ```

### 第 5 步：完成任务

1.  **提交您的变更：** 使用清晰、描述性的消息提交您的工作，并遵循常规提交标准（例如 `feat: 通过 JWT 实现用户认证`）。
2.  **将任务标记为完成：** 所有代码提交并通过测试后，运行 `complete` 命令。这会将任务移动到 `done` 目录。
    ```bash
    python cli.py complete --task-id 001
    ```

## 错误处理与特殊协议

-   **如果命令失败：** 仔细阅读错误消息。在不理解原因的情况下，不要重试相同的命令。如果错误来自 `cli.py` 工具，请查阅其 `--help` 菜单。
-   **如果您需要删除文件：** 使用 `python cli.py delete <filepath>` 命令。它会提示您进行风险评估。您必须为删除操作提供明确的理由。
-   **如果您遇到困难：** 不要猜测。停下来请求指导。清楚地说明您面临的问题以及您已采取的步骤。
