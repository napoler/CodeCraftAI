# 贡献指南 (Contribution Guidelines)

欢迎你为 CodeCraftAI 项目贡献代码或文档！本指南旨在帮助每一位成员高效协作，并共同维护项目的长期健康。

## 1. 项目理念

我们不仅仅是在构建一个项目，更是在实践一套高效、透明、可追溯的开发哲学。我们建立的所有规范（Spec、ADR、Git工作流等）都是为了服务于以下核心目标：

*   **清晰优于聪明**: 我们更倾向于清晰、可读的代码和文档，而不是难以理解的“聪明”技巧。
*   **决策可追溯**: 任何重要的技术决策都应该被记录下来，以便未来的我们能够理解当时“为什么”这样做。
*   **自动化保障质量**: 我们相信应该让工具来做重复性的、易错的检查工作，让人类专注于创造性的、有价值的思考。
*   **文档驱动开发**: 我们在编码前思考和写作，确保我们在正确的方向上努力。

## 2. 我们的工具链

为了实现上述理念，我们采用了一套精心挑选的、行业标准的工具链。了解它们的作用将帮助你更好地为项目做贡献。

*   **`pytest`**: Python 的黄金标准测试框架。我们用它来保证代码的正确性和健壮性。
*   **`black`**: “不妥协”的代码格式化工具。它能终结所有关于代码风格的争论，让所有代码看起来都像一个人写的。
*   **`ruff`**: 极速的 Python Linter。它能在瞬间扫描代码，发现从简单语法错误到复杂逻辑缺陷的数百种问题。
*   **`pre-commit`**: Git 钩子管理器。它是我们的自动化质量守卫，在每次你提交代码时，它都会自动运行 `black` 和 `ruff`，确保不符合质量标准的代码无法进入我们的代码库。
*   **`pip-tools`**: 依赖管理工具。我们用它将 `pyproject.toml` 中定义的高级依赖，编译成包含精确版本号的 `requirements.txt` 文件，以确保环境的绝对可复现性。

## 3. 沟通语言

为了方便当前团队的沟通，我们约定所有公开的交流和文档编写均使用 **中文**。这包括 Git 提交信息、Pull Request、代码注释、规范文档等。

*注：随着项目的发展和国际化，未来可能会转为使用英语。*

## 4. 进度同步与任务管理

我们使用 **GitHub Issues** 和 **Project Boards** 来实现开发进度的透明化管理。

1.  **一切始于 Issue**: 任何开发任务（新功能、Bug修复、重构等）都应该从创建一个 Issue 开始。请使用我们提供的 [Issue 模板](/.github/ISSUE_TEMPLATE) 来确保信息的完整性。
2.  **认领任务**: 当你准备开始一个任务时，请将自己分配（Assign）给对应的 Issue。
3.  **使用看板**: 项目维护者会将 Issue 添加到项目看板中。请在开发过程中，及时将代表你任务的卡片在看板的不同列（如 `待办` -> `进行中` -> `待审查`）之间移动。
4.  **关联 PR**: 当你提交 Pull Request 时，请在描述中链接到对应的 Issue (例如 `Closes #42`)，这样当 PR 被合并后，相关的 Issue 将被自动关闭。

## 5. Git 工作流规范

我们遵循一个结构化的 Git 工作流，以保持版本历史的清晰和可追溯性。

### 分支命名

所有分支都应从 `main` 分支创建，并遵循 `类型/简短描述` 的格式（示例: `feat/real-time-debugging`, `fix/login-bug`）。详细的 `<类型>` 列表请见下文。

### 提交信息 (Commit Messages)

我们采用 **Conventional Commits** 规范。格式为 `<类型>[可选的作用域]: <描述>`。

**`<类型>`** 必须是以下之一：
*   **feat**: 新功能
*   **fix**: Bug 修复
*   **docs**: 文档变更
*   **style**: 代码风格
*   **refactor**: 代码重构
*   **test**: 增加或修改测试
*   **chore**: 构建过程或辅助工具的变动

## 6. 开发全流程

1.  **领取任务**: 从 Issue 列表中选择或创建一个任务，并分配给自己。
2.  **理解上下文**:
    *   仔细阅读 Issue 描述和验收标准。
    *   阅读相关的 **规范文档 (`specs/`)**。
    *   **查阅相关的架构决策记录 (`adr/`)**，特别是那些可能会影响你本次实现的关键决策。
3.  **创建分支**: 从最新的 `main` 分支，根据“分支命名”规范创建一个新的分支。
4.  **编码与测试**:
    *   进行代码开发和文档编写。
    *   为你的代码编写必要的测试，并确保所有测试都能通过 (`pytest`)。
    *   在编码过程中，可以随时运行 `pre-commit run --all-files` 来检查你的代码质量。
5.  **提交代码**: 遵循“提交信息”规范，提交你的代码。`pre-commit` 会在此时自动运行。
6.  **发起 Pull Request**:
    *   将你的分支推送到远程仓库，并创建一个指向 `main` 分支的 Pull Request。
    *   使用我们的 [Pull Request 模板](/.github/PULL_REQUEST_TEMPLATE.md) 填写所有必要信息。
7.  **代码审查与合并**: 你的 PR 需要至少一位其他团队成员的批准才能被合并。

## 7. 决策记录

*   **规范 (Specs)**: 所有对用户可见或对系统有重要影响的变更，都必须先编写一份规范文档。
*   **架构决策记录 (ADRs)**: 当一项规范的讨论中产生了对项目有长远影响的重要技术决策时（例如，选择一个特定的数据库、定义一个核心的API范式等），应将其沉淀为一份ADR文档，存放在 `adr/` 目录中。
*   **AI 协作记录**: 我们与 AI 助手的关键决策性对话摘要，会存放在 `adr/ai-sessions/` 目录中，作为项目历史的一部分。

## 8. 代码注释

*   **解释“为什么”，而不是“做什么”**。
*   为复杂的业务逻辑、算法或需要注意的陷阱添加注释。
*   使用 `# TODO:` 或 `# FIXME:` 来标记技术债。

## 9. 构建与发布

我们拥有一个与云端 CI/CD 流程对齐的本地构建脚本，以确保所有开发者都能在本地验证构建的完整性。

### 本地构建

在推送代码或发起 Pull Request 之前，我们强烈建议你运行本地构建脚本：

```bash
bash scripts/build.sh
```
这个脚本会自动执行包括依赖检查、测试、文档生成和打包在内的所有关键步骤。只有当这个脚本成功运行时，你的代码才被认为是“准备好提交”的。

### 官方发布

项目的官方发布流程是自动化的，通过 GitHub Actions 实现。当一个版本标签（如 `v1.2.0`）被推送到 `main` 分支时，CI/CD 流程会自动触发，构建所有产出物（Python包、文档网站），并创建一个新的 GitHub Release。

## 10. 更新项目文档

本项目遵循“文档即代码 (Docs-as-Code)”的哲学。这意味着，对任何文档的修改，都应遵循与修改代码**完全相同**的严格流程。

1.  **创建 Issue**: 提出一个修改文档的建议，并解释“为什么”需要修改。
2.  **创建分支**: 遵循 `docs/<description>` 的分支命名规范。
3.  **修改文档**: 进行实际的修改。
4.  **发起 Pull Request**: 提交 PR，并清晰地说明文档的变更内容。
5.  **同行审查 (Peer Review)**: 文档的修改也需要至少一位其他团队成员的审查和批准。

> **重要提示**: 在提交任何变更前，请确保你没有将任何本地生成的临时文件或测试产出（如 `htmlcov/`, `site/`）添加到 Git 的暂存区。我们的 `.gitignore` 文件应该能处理绝大多数情况，但最终的责任仍在提交者。

## 11. 确保API调用准确性的混合模式工作流

为了从根本上杜绝因第三方库使用不当而引发的错误，我们建立了一套智能、灵活且强制的“混合模式”工作流。此工作流的核心是提升AI的自主决策与探索能力，同时兼顾团队的知识沉淀需求。

### AI的核心准则：自主决策与适应

作为AI开发者，你被赋予了决策权，并需要遵循以下逻辑来保证API调用的准确性：

1.  **识别核心依赖**: 当你判断一个库是项目的核心依赖（如 `pandas`, `numpy`），或者你认为它值得为整个团队沉淀一份永久性的参考文档时，你应**首先尝试使用自动化工具**来生成这份文档。
    ```bash
    python scripts/generate_api_docs.py <library_name>
    ```
2.  **工具失效时，自动切换**: 如果自动化工具因任何原因（如库不兼容）执行失败，你**必须自动切换**到下述的“主动探索与临时笔记”工作流。
3.  **常规开发，默认主动探索**: 对于常规的、非核心的开发任务，或者当你只需要探索库的某个特定部分时，你**必须默认使用**“主动探索与临时笔记”工作流，因为它更轻量、更高效。

### 强制性工作流：主动探索与临时笔记

这是保证日常开发质量的基石，也是AI在工具失效或进行常规开发时的**强制性**工作流程。

1.  **主动探索与分析**: 在使用任何新的或复杂的库之前，先编写一个临时的探索脚本（如 `tmp_explore_lib.py`）。在此脚本中，使用 `dir()` 和 `help()` 等Python内建函数来系统性地检查库的可用API、参数和文档字符串。
2.  **生成临时文档**: 将探索得到的核心API信息，结合官方文档（如果能通过搜索找到），整理成一个临时的Markdown笔记文件（如 `temp_api_notes.md`）。这份笔记将作为开发过程中的“第二大脑”和快速参考。
3.  **依据文档开发**: 严格依据你创建的这份临时笔记进行编码，确保所有函数调用、参数和数据结构都准确无误。
4.  **提交前清理**: 在提交代码（`git commit`）之前，**必须删除**所有临时的探索脚本和笔记文件，以保持项目仓库的整洁。

### 团队的可选工具：构建共享知识库

团队的任何成员都可以使用API文档生成器来为项目贡献一份永久的、共享的API参考。

*   **使用场景**: 当你认为某个库对项目至关重要，值得所有成员随时查阅时。
*   **使用方法**:
    ```bash
    python scripts/generate_api_docs.py <library_name_1> <library_name_2>
    ```
*   **注意**: 生成的文档目录 (`docs/api_reference/`)已被配置在 `.gitignore` 中，不应被提交到版本库。文档的构建和部署由CI/CD流水线在服务器端自动完成。

感谢你的贡献！
