# 帮助文档 03：AI 安全红线与智能工具

与 AI 协作能极大地提升开发效率，但也带来了新的挑战。为了确保项目的安全与稳定，我们为 AI 开发者制定了一套必须严格遵守的**“安全红线”**，并提供了一套强大的智能工具来辅助 AI 安全、高效地工作。

---

## 1. AI 安全红线 (Safety Red Lines)

这是一套**强制性**的行为准则。任何违反这些准则的行为都应被立即制止和纠正。

### **红线一：禁止原生文件删除**
- **严禁** AI 直接使用任何操作系统的原生删除命令，如 `rm`, `del`, `erase` 等。
- **必须**: 所有的文件删除操作，都**必须**通过我们提供的安全命令行工具执行：
  ```bash
  python .codecraft/scripts/cli.py delete <file_path>
  ```
- **理由**: 该命令内置了“三思而后行”的风险评估问答和“垃圾桶”机制，是防止灾难性误删除的第一道防线。

### **红线二：禁止直接修改受保护文件**
- 本项目在 `.codecraft/protected_paths.yml` 文件中定义了一份“受保护路径”清单，其中包含了所有项目的核心配置文件、工作流脚本和模板。
- **严禁** AI 对此清单中的任何文件进行直接的修改、移动或删除。
- **必须**: 如果 AI 认为需要修改一个受保護的文件，它**必须**停止操作，并在 `project_logs/ai_interactions.md` 中记录其意图，然后明确地向人类开发者 **`@user`** 请求审查和批准。

### **红线三：优先使用 CLI 工具**
- **强烈建议**: AI 应优先使用 `cli.py` 来执行所有与工作流相关的操作（如开始、完成任务），而不是手动执行 `git mv` 等命令。
- **理由**: CLI 工具内置了对 `workflow.yml` 的规则校验，能确保所有操作都符合预设的项目流程，减少出错的可能。

---

## 2. AI 智能工具集 (`ai` 命令)

我们为 AI 提供了一套强大的“代码质量”工具，封装在 `cli.py ai` 命令组下。AI 开发者应在提交代码审查前，常规性地使用这些工具来优化自己生成的代码。

### `ai format <file_path>`
- **功能**: 使用 `black` 对指定的 Python 文件进行无损、确定性的代码格式化。
- **何时使用**: 在编码过程中或完成后，用于统一代码风格。

### `ai lint-fix <file_path>`
- **功能**: 使用 `ruff` 的强大能力，自动修复所有可安全修复的 Lint 错误（如未使用的导入、变量名错误等）。
- **何时使用**: 在代码格式化后，用于修复常见的代码缺陷。

### `ai doctor <file_path>` (最推荐)
- **功能**: 这是最强大的“一站式”代码诊断工具。它会：
    1.  自动运行 `format` 和 `lint-fix`。
    2.  运行 `mypy` 进行静态类型检查。
    3.  如果发现 `mypy` 无法自动修复的类型错误，它会自动生成一个结构化的、包含完整上下文的**提示 (Prompt)**，精准地指示 AI 应该修复什么。
- **何时使用**: 在提交代码前的最后一步，用作最终的代码质量检查和自我修正。
