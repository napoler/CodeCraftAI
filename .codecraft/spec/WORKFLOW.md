# CodeCraft Spec 工作流 v2.4

本规约定义了 `CodeCraftAI` 项目所有开发活动（无论是创建新功能还是修订现有功能）都必须遵循的、标准化的、可审计的流程。

---

## 零号流程：深度规划会话 (Phase 0: Deep Planning Session)

> **入口点**: 所有规约的生命周期（无论是创建还是修订）都必须从此流程开始。

根据“#10. 主动澄清责任”原则，AI 代理在收到用户任何非琐碎的指令后，必须启动一次“深度规划会话”。

1.  **触发**: 用户提出初始请求，或 AI 遇到模糊指令。
2.  **活动**: AI 通过苏格拉底式的提问，与用户进行多轮对话，共同探索需求的细节、边界、约束和真实目标。
3.  **输出**: 对接下来要执行的流程（是“创建新规约”还是“修订现有规约”）达成明确共识。

---

## A. 新规约创建流程

> **适用场景**: 当“深度规划会话”确认需要创建一个全新的功能或变更时。

### A.1 流程分级 (Tiered Process)

为了平衡**严谨性**与**敏捷性**，新规约的创建分为两种流程级别：

-   **Tier-1 (Full):** **默认流程**，适用于所有**新功能**、**重大架构变更**等。
-   **Tier-2 (Lite):** **简化流程**，适用于**小型的 bug 修复**、**内部重构**等。

### A.2 Tier-1 (Full) 工作流

1.  **Phase 1: 提案** (AI 创建 `spec.md` 草案)
2.  **Phase 2: 阶段划分与审批** (AI 提议阶段划分 -> **人类审批**)
3.  **Phase 3: 实施** (AI 根据已批准的 `<核心功能>` 进行开发)
4.  **Phase 4: 验证与文档同步**
5.  **Phase 5: 归档与索引**

### A.3 Tier-2 (Lite) 工作流
1.  **Phase 1: 提案** (AI 创建简洁的 `spec.md` 草案)
2.  **Phase 2: 审查与实施** (无需人类审批即可开始，但人类可随时叫停)
3.  **Phase 3: 验证与归档**

---

## B. 规约修订流程 (New!)

> **适用场景**: 当“深度规划会话”确认需要对一个**已存在**的规约进行修改时。

1.  **Phase 1: 检出与锁定**
    -   *活动*: AI 代理找到目标规约文件（例如 `spec-003`），并通知团队该规约正处于修订中（例如，通过创建一个草稿 PR）。

2.  **Phase 2: 形成变更清单**
    -   *活动*: 在“深度规划会话”中，AI 与用户共同确定一个清晰、明确的变更点列表。

3.  **Phase 3: 应用变更与版本升级**
    -   *活动 (AI)*: AI 代理将变更应用到规约文件上。
    -   *活动 (AI)*: AI 代理**必须**更新 `<元数据>` 块中的 `<版本>` 标签（例如，从 `1.0` 升级到 `1.1`）。
    -   *输出*: 一个内容已更新、版本号已提升的 `spec.md` 文件。

4.  **Phase 4: 重新审批与归档**
    -   *活动*: 被修订的规约**必须**像新规约一样，重新经过 `Tier-1` 或 `Tier-2` 流程的审查和批准。
    -   *活动*: 一旦批准，更新后的规约将取代旧版本，并（如果适用）被重新归档。

---

## 附录

(附录 A, B, C 保持不变)
