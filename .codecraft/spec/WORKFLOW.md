# CodeCraft Spec 工作流

本规约详细定义了 `CodeCraftAI` 项目中，一个规约从概念到完成所必须遵循的、以“**人机审批循环**”为核心的端到端流程。

## 规约的生命周期

1.  **Phase 1: 提案 (Proposal)**
2.  **Phase 2: 审查与完善 (Review & Refine)**
3.  **Phase 2.5: 细化与审批 (Refinement & Approval) - [关键人机交互点]**
4.  **Phase 3: 实施 (Implementation)**
5.  **Phase 4: 验证与文档同步 (Verification & Doc-Sync)**
6.  **Phase 5: 归档与索引 (Archive & Indexing)**

---

### Phase 1: 提案
**目标:** AI 基于高级指令，创建一份结构化的 `spec.md` 草案。
**流程:**
1.  **AI 必须**首先加载并分析全局索引 (`INDEX.md`)。
2.  创建变更目录，并初始化 `spec.md`。
3.  **AI 必须**完成 `spec.md` 草案的撰写。

---

### Phase 2: 审查与完善
**目标:** 人类与 AI 对高级规约 (`spec.md`) 达成共识。
**流程:**
1.  **AI 必须**主动提出细化建议和潜在的歧义点。
2.  人类开发者审查 `spec.md`，并提供反馈。
3.  循环此过程，直至人类开发者将 `spec.md` 的 `<状态>` 标签更新为 `已批准`。

---

### Phase 2.5: 细化与审批 (关键人机交互点)
**目标:** 确保 AI 对任务的细化拆解，符合人类的预期。
**流程:**
1.  **AI 必须**基于已批准的 `spec.md`，自动生成**草稿版**的 `tasks.md` 和 `DEV_SPEC.md`。
2.  **AI 必须暂停执行**，并明确地、主动地向人类用户**请求对这两份细化文档的审批**。
3.  **人类用户必须**审查这两份文档。
4.  只有在获得用户的**明确批准**后，AI 才能继续。

---

### Phase 3: 实施
**目标:** 高质量地编码。
**流程:**
1.  **AI 必须**严格按照**经过审批的** `DEV_SPEC.md` 和 `tasks.md` 进行 TDD 开发。

---

### Phase 4: 验证与文档同步
**目标:** 确保代码质量，并履行“文档同步是铁律”的原则。
**流程:**
1.  运行所有自动化测试和质量检查。
2.  **AI 必须**执行一次全面的**文档影响分析**，并更新所有受代码变更影响的文档。
3.  **AI 必须**明确地向用户报告，哪些文档已被更新，以证明与代码的一致性。

---

### Phase 5: 归档与索引
**目标:** 将本次变更的产出，贡献给项目的长期知识库。
**流程:**
1.  将整个变更目录归档。
2.  **AI 必须**将本次规约中新创建的所有 UID（规约、功能等），注册到全局的 `INDEX.md` 中，完成知识图谱的更新。
